ARCH=$(shell uname --m)
ifeq ($(ARCH),aarch64)
	ARCH=arm64
endif

ifeq ($(ARCH),x86_64)
	ARCH=amd64
endif


all: prebuild deps
	sudo docker build -t uaptn/tracker-ui:latest .

docker:
	cp ../../bin/$(ARCH)/linux/tracker-ui artifacts/
	sudo docker build -t uaptn/tracker-ui:latest .

prebuild:
	mkdir -p artifacts

deploy: all
	sudo docker login --username nibbleshift
	sudo docker push uaptn/tracker-ui:latest

deps:
	mkdir -p artifacts/frontend
	make -C ../../cmd tracker-ui
	cp ../../cmd/bin/$(ARCH)/linux/tracker-ui artifacts/
	make -C ../../web/tracker-ui
	cp -aR ../../web/tracker-ui/dist/* artifacts/frontend


